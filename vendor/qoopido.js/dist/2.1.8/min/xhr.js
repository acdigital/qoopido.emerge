(function(e,t){"use strict";var n=function n(){return t.qoopido.shared.module.initialize("xhr",e,arguments)};"function"==typeof define&&define.amd?define(["base","unique","q"],n):n(t.qoopido.base,t.qoopido.unique,t.Q)})(function(e,t,n,r,o,i){"use strict";function s(e){if("object"==typeof e){var t;for(t in e)w[t]!==undefined&&(w[t]=e[t])}}function u(e){var t,n=this;e="object"==typeof e?e:{};for(t in w)n.settings[t]=e[t]||w[t]}function a(e){if(""===e)try{return location.href}catch(t){}return v.href=e,v.href}function c(e,t,n){var r,o=this,i=o.xhr,s=o.settings;n="object"==typeof n?m(n):n,t=s.cache===!1?"".concat(t,t.indexOf("?")>-1?"&":"?","_="+(new Date).getTime()):t,t=n&&"GET"===e?"".concat(t,t.indexOf("?")>-1?"&":"?",n):t;for(r in s.xhrOptions)i[r]=s.xhrOptions[r];i.open(e,t,s.async,s.username,s.password),i.setRequestHeader("Accept",s.accept),n&&"GET"!==e&&i.setRequestHeader("Content-Type",s.contentType);for(r in s.header)i.setRequestHeader(r,s.header[r]);i.timeout=s.timeout,i.onprogress=function(){p.apply(o)},i.onreadystatechange=function(){d.apply(o)},i.onerror=function(){l.apply(o)},i.send(n||null),o.timeout=setTimeout(function(){f(i)},s.timeout)}function f(e){e.abort()}function p(){this.dfd.notify()}function d(){var e=this,t=e.xhr,n=e.dfd;4===t.readyState&&(clearTimeout(e.timeout),200===t.status?n.resolve(t.responseText,t):n.reject(t.status,t))}function l(){var e=this;clearTimeout(e.timeout),e.dfd.reject()}function m(e,t){var n,r,o,i=[];for(n in e)r=t?"".concat(t,"[",n,"]"):n,o=e[n],i.push("object"==typeof o?m(o,r):"".concat(encodeURIComponent(r),"=",encodeURIComponent(o)));return i.join("&")}var h,y,g,v=i.createElement("a"),w={accept:"*/*",timeout:5e3,async:!0,cache:!1,header:{},username:null,password:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8 ",xhrOptions:{}},b=o.XMLHttpRequest!==undefined?function(e){return g.test(e)?new o.XMLHttpRequest:o.XDomainRequest?new o.XDomainRequest:new o.XMLHttpRequest}:function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return null}};try{y=location}catch(x){v.href="",y=v}return g=RegExp("".concat("^",y.protocol,"//",y.hostname),"i"),h=e.extend({setup:function(e){return s(e),this},load:function(e,r,o,i){var s={};return r=a(r),s.id=t.string(),s.dfd=n.defer(),s.xhr=b(r),s.timeout=null,s.settings={},u.apply(s,[i]),c.apply(s,[e.toUpperCase(),r,o]),s.dfd.promise},get:function(e,t,n){return this.load("GET",e,t,n)},post:function(e,t,n){return this.load("POST",e,t,n)},put:function(e,t,n){return this.load("PUT",e,t,n)},"delete":function(e,t,n){return this.load("DELETE",e,t,n)},head:function(e,t,n){return this.load("HEAD",e,t,n)}})},window,document);